<!DOCTYPE HTML>
<html>
    <head>
        <title>SplatoonGearSearch</title>
	</head>
    <script>
        var MAX_STEP = 30;
        var BrandName = [
        "战斗鱿鱼 / SquidForce",
        "钢铁先锋 / Zink",
        "海月 / Krak-On",
        "罗肯贝格 / Rockenberg",
        "泽酷 / Zekko",
        "锻品 / Forge",
        "暖流 / Firefin",
        "帆立 / Skalop",
        "寺门 / Splash Mob",
        "时雨 / Barazushi",
        "艾洛眼 / Tentatek",
        "暇古 / Takoroka",
        "无法无天 / Annaki",
        "鱿皇 / Enperry",
        "剑尖鱿 / Toni Kensa",
        "散寿司 / Barazushi",
        "七轮 / Emberz",
        "熊先生商会 / Grizzco",
        "鱼干制造 / Cuttlegear",
        "amiibo"
        ];

        var AbilityName = [
        "主省 / 提升墨汁效率(主要武器)",
        "副省 / 提升墨汁效率(次要武器)",
        "墨回 / 提升墨汁槽的回复速度",
        "走速 / 提升人类状态移动速度",
        "游速 / 提升鱿鱼游动速度",
        "大招减量 / 提升特殊武器增加量",
        "sp死亡减轻 / 降低特殊武器减少量",
        "大招增强 / 提升特殊武器的性能",
        "快速复活 / 缩短复活时间",
        "超级跳 / 缩短超级跳跃的时间",
        "副强 / 提升次要武器的性能",
        "安全鞋 / 减轻对手墨汁影响",
        "防爆 / 减轻次要武器影响",
        "行动强化"
        ];
        var BrandTend = [11, 0, 9, 8, 4, 12, 3, 4, 6, 5, 7, 1, 2, 8, 6, 0, 3, 12, 13, 
        2, 9, 5, 7, 1, 6, 10, 11, 0, 10, 13, 10, -1, -1, -1, -1, -1, -1];
        class GearAbility{
            constructor(Ability, Seed, Brand){
                this.Ability = Ability;
                this.Brand = Brand;
                this.Seed = Seed;
            }
            GetNextAbility(Drink){
                this.Seed = GetNextSeed(this.Seed);
                if(Drink < 0 || Drink > 13){
                    this.Ability = GetSeedAbility(this.Seed, this.Brand, -1);
                    return this;
                }
                if(this.Seed % 100 < 30){
                    this.Ability = Drink;
                    return this;
                }
                this.Seed = GetNextSeed(this.Seed);
                this.Ability = GetSeedAbility(this.Seed, this.Brand, Drink);
                return this;
            }
        }
        class PlanResult{
            constructor(StepNum, StepSeed, DrinkNum){
                this.StepNum = StepNum;
                this.StepSeed = StepSeed;
                this.DrinkNum = DrinkNum;
            }
        }
        function GetSeedAbility(Seed, Brand, Drink){
            let AllWeight;
            let Stend = BrandTend[Brand * 2];
            let Wtend = BrandTend[Brand * 2 + 1];
            if(Stend == -1){
                if(Drink < 0 || Drink > 13) AllWeight = 28;
                else    AllWeight = 26;
            }else{
                if(Drink == Stend)  AllWeight = 25;
                else if(Drink == Wtend)  AllWeight = 34;
                else    AllWeight = 33;
            }
            let Weight = Seed % AllWeight;
            for(var temp = 0; temp < 13; temp++){
                if(temp == Drink)   continue;
                else if(temp = Wtend)    Weight = Weight - 1;
                else if(temp = Stend)    Weight = Weight - 10;
                else    Weight = Weight + 2;
                if(Weight < 0)  return temp;
            }
        }

        function GetNextSeed(Seed){
            Seed ^= (Seed << 13);
            Seed ^= (Seed >>> 17);
            Seed ^= (Seed << 5);
            Seed = Seed >>> 0;
            return Seed;
        }

        function SeedFindAll(Seed){
            
        }
        function SeedFindN(Seed, drink, Target){
            for(let temp = 0; temp < AbilityName.length + 1; temp++){
                let SeedTemp = Seed.GetNextAbility((temp + drink) % 15);
                if(SeedTemp.Ability == Target){
                    return temp;
                }
            }
            return -2;
        }
        function SeedFindNN(Seed, drink, TargetCode){
            let cost1 = -2;
            let cost2 = -1;
            for(let temp = 0; temp < AbilityName.length + 1; temp++){
                if((Seed.GetNextAbility((temp + drink) % 15)).Ability == TargetCode[1]){
                    cost1 = temp;
                    if(TargetCode[2] != -1){
                        Seed = Seed.GetNextAbility(temp);
                        cost2 = SeedFindN(Seed, temp, TargetCode[2]);
                        if(cost2 == -2) return [-2,-2];
                    }
                    return [cost1, cost2];
                }
            }
            return [-2,-2];
        }

        function CostNumCalcu(drink, cost, OStep, BStep){
            var res = new Array();
            let resnum = 0;
            if(drink > -1 && drink < 14){
                res[resnum + 1] = drink * 100 + OStep;
                resnum ++;
            }    
            if(cost[0] != drink && cost[0] > -1 && cost[0] < 14){
                res[resnum + 1] = cost[0] * 100 + BStep + OStep;
                resnum++;
            }
            if(cost[0] != cost[1] && cost[1] > -1 && cost[1] < 14){
                res[resnum + 1] = cost[1] * 100 + BStep + 1 + OStep;
                resnum ++;
            }
            res[0] = resnum;
            return res;
        }

        function SeedFind(Seed, TargetCode, IsFindAll){
            var SeedOri = Seed;
            var CostNum = new Array();
            var CostNumP = 4;
            var PlanNum = 0;
            var PlanData = new Array();
            var ResStep = new Array();
            var PlanStepToDrink = new Array();
            for(var OriginStep = 0; OriginStep < MAX_STEP ; OriginStep ++){
                let SeedBrance = new GearAbility({}, SeedOri);
                
                for(var BranceStep = 0; BranceStep < 3; BranceStep ++){
                    for(var drink = -1; drink < AbilityName.length; drink++){
                        for(var temp = 0; temp < BranceStep + 1; temp++){
                            SeedBrance = SeedBrance.GetNextAbility(drink);
                            ResStep[OriginStep + temp] = new GearAbility({}, SeedBrance);
                        }
                        if(SeedBrance.Ability == TargetCode[0]){
                            var Cost = SeedFindNN(SeedBrance, drink, TargetCode);

                            if (Cost[0] == -2)  continue;

                            CostNum = CostNumCalcu(drink, Cost, OriginStep, BranceStep);

                            if(CostNum[0] >= CostNumP) continue;

                            CostNumP = CostNum[0];

                            let plan = new PlanResult();

                            ResStep[OriginStep + BranceStep + 1] = TargetCode[1];

                            if(TargetCode[2] != -1)
                                ResStep[OriginStep + BranceStep + 2] = TargetCode[2]
                            
                            if(TargetCode[2] == -1){
                                plan.StepNum = OriginStep + BranceStep + 2;
                            }else{
                                plan.StepNum = OriginStep + BranceStep + 3;
                            }

                            plan.StepSeed = ResStep;
                            plan.DrinkNum = CostNum;

                            PlanData[PlanNum] = plan;
                            PlanNum ++;

                            if(IsFindAll == 1)  return PlanData;
                        }
                    }
                }

                SeedOri = SeedOri.GetNextAbility(-1);
                ResStep[OriginStep] = new GearAbility({}, SeedOri);
            }
            return PlanData;
        }

        function SeedFindOut(ResArr){

            IDtable0  =document.getElementById('IDtable0');
            var tab='<table border=1 width=500">'
            tab = tab + "<tr> <td style='background:white'>步骤</td><td style='background:white'>技能</td><td style='background:white'>种子</td> </tr>"

            plan0 = ResArr[0];

            for(var i = 0; i < plan0.StepNum; i++){
                tab+='<tr>';
                tab += "<td style='background:white'>" + (i + 1) + "</td>";
                tab += "<td style='background:white'>" + plan0.StepSeed[i].Ability + "</td>";
                tab += "<td style='background:white'>0x" + plan0.StepSeed[i].Seed.toString(16) + "</td>";
                tab += '</tr>';
            }
            tab+='</table>';
            IDtable0.innerHTML = tab;
        }

        function MainFunction(){

            var SeedMain = new GearAbility;
            SeedMain.Seed = parseInt(document.getElementById('IDSeed').value);
            SeedMain.Seed = SeedMain.Seed >>> 0;
            SeedMain.Brand = parseInt(document.getElementById('IDClothes').value);


            var TargetCode = new Array(3);
            var Result = new Array();
            TargetCode[0] = parseInt(document.getElementById('IDTarget1').value);
            TargetCode[1] = parseInt(document.getElementById('IDTarget2').value);
            TargetCode[2] = parseInt(document.getElementById('IDTarget3').value);

            if(TargetCode[0] == -1){
                Result = SeedFindAll(SeedMain);
                //SeedFindAllOut(Result);
            }else{
                Result = SeedFind(SeedMain, TargetCode, 0);
                SeedFindOut(Result);
            }
        }
    </script>
    <style>
        table {
            border-collapse: collapse;
            margin-top: 200px;
            margin-left: 500px;
        }
        table th{
            border: 1px solid black;
            width: 80px;
            height: 40px;
            text-align: center;
            background-color: cornsilk;
        }

        table td{
           
            border: 1px solid black;
            width: 80px;
            height: 40px;
            text-align: center;

        }
        body {
            background-color: #e9ecef;
            width: 90%;
            padding: 4rem 2rem;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;
        }
        .wrapper {
            background-color: #fff;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 1rem;
            margin-top: 10px;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: .5rem;
            font-weight: 500;
            line-height: 1.2;
            margin-top: 0;
        }
        </style>
    <body>
        <div class = "content">
            <h1>喷喷喷技能搜索器</h1>
            <div class="wrapper">
				<p>测试一下</p>
		    </div>

            <h2>请输入衣服种子</h2>
            <div>
                <input type = "text" id = "IDSeed" value = "0x915cfc31"/>
            </div>

            <form method="post" action=" ">
                <h2>请选择衣服品牌</h2>
                <p>
                  <select id="IDClothes"name="fave">
                      <option value= '0' selected label="战斗鱿鱼 / SquidForce">战斗鱿鱼 / SquidForce</option>
                      <option value= '1' label="钢铁先锋 / Zink">钢铁先锋 / Zink</option>
                      <option value= '2' label="海月 / Krak-On">海月 / Krak-On</option>
                      <option value= '3' label="罗肯贝格 / Rockenberg">罗肯贝格 / Rockenberg</option>
                      <option value= '4' label="泽酷 / Zekko">泽酷 / Zekko</option>
                      <option value= '5' label="锻品 / Forge">锻品 / Forge</option>
                      <option value= '6' label="暖流 / Firefin">暖流 / Firefin</option>
                      <option value= '7' label="帆立 / Skalop">帆立 / Skalop</option>
                      <option value= '8' label="寺门 / Splash Mob">寺门 / Splash Mob</option>
                      <option value= '9' label="时雨 / Barazushi">时雨 / Barazushi</option>
                      <option value= '10' label="艾洛眼 / Tentatek">艾洛眼 / Tentatek</option>
                      <option value= '11' label="暇古 / Takoroka">暇古 / Takoroka</option>
                      <option value= '12' label="无法无天 / Annaki">无法无天 / Annaki</option>
                      <option value= '13' label="鱿皇 / Enperry">鱿皇 / Enperry</option>
                      <option value= '14' label="剑尖鱿 / Toni Kensa">剑尖鱿 / Toni Kensa</option>
                      <option value= '15' label="散寿司 / Barazushi">散寿司 / Barazushi</option>
                      <option value= '16' label="七轮 / Emberz">七轮 / Emberz</option>
                      <option value= '17' label="熊先生商会 / Grizzco">熊先生商会 / Grizzco</option>
                      <option value= '18' label="鱼干制造 / Cuttlegear">鱼干制造 / Cuttlegear</option>
                      <option value= '19' label="amiibo">amiibo</option>
                  </select>
                </p>
            </form>
            <div>
                <h3>请输入目标序列</h3>
                <input  type = "text" id = "IDTarget1" value = "1"/>
                <input  type = "text" id = "IDTarget2" value = "2"/>
                <input  type = "text" id = "IDTarget3" value = "3"/>
            </div>
            <div>
                <input  id="button" type="button" value="生成方案" onclick="MainFunction();">
            </div>
            <div id = "IDtable0"></div>
            <div id = "IDtable1"></div>
            <div id = "IDtable2"></div>
            <div id = "IDtable3"></div>
            <div id = "IDtable4"></div>
            <div id = "IDtable5"></div>
            <div id = "IDtable6"></div>
            <div id = "IDtable7"></div>
            <div id = "IDtable8"></div>
            <div id = "IDtable9"></div>
            <div id = "IDtable10"></div>
            <div id = "IDtable11"></div>
            <div id = "IDtable12"></div>
            <div id = "IDtable13"></div>
            <div id = "IDtable14"></div>
            <div id = "IDtable15"></div>
            <div id = "IDtable16"></div>
            <div id = "IDtable17"></div>
            <div id = "IDtable18"></div>
        </div>

    </body>
    
    <body>
        <h3>动态创建表格1</h3>
        行数 <input type="text" value="5" id="rows">
        列数 <input type="text" value="5" id="cols">
        <input type="button" value="创建表格" onclick="creatTab()">
        <div id="div1"></div>
        <script>
        function creatTab(){
            rows = document.getElementById('rows').value
            cols = document.getElementById('cols').value
            div1  =document.getElementById('div1')
            // alert(rows+'\n'+cols)
            var tab='<table border=1 width=500">'
            for(var i=0;i<rows;i++){
                tab+='<tr>'
                for(var j=0;j<cols;j++){
                    tab+="<td style='background:white'>"+i+j+"</td>"
                }
                 tab+='</tr>'
            }
            tab+='</table>';
            div1.innerHTML=tab
        }
        </script>
    </body>
</html>