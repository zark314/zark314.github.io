<!DOCTYPE HTML>
<html>
    <head>
        <title>SplatoonGearSearch</title>
	</head>
    <script>
        var MAX_STEP = 30;
        var BrandName = [
        "战斗鱿鱼 / SquidForce",
        "钢铁先锋 / Zink",
        "海月 / Krak-On",
        "罗肯贝格 / Rockenberg",
        "泽酷 / Zekko",
        "锻品 / Forge",
        "暖流 / Firefin",
        "帆立 / Skalop",
        "寺门 / Splash Mob",
        "时雨 / Barazushi",
        "艾洛眼 / Tentatek",
        "暇古 / Takoroka",
        "无法无天 / Annaki",
        "鱿皇 / Enperry",
        "剑尖鱿 / Toni Kensa",
        "散寿司 / Barazushi",
        "七轮 / Emberz",
        "熊先生商会 / Grizzco",
        "鱼干制造 / Cuttlegear",
        "amiibo"
        ];

        var AbilityName = [
        "主省 / 提升墨汁效率(主要武器)",
        "副省 / 提升墨汁效率(次要武器)",
        "墨回 / 提升墨汁槽的回复速度",
        "走速 / 提升人类状态移动速度",
        "游速 / 提升鱿鱼游动速度",
        "大招减量 / 提升特殊武器增加量",
        "sp死亡减轻 / 降低特殊武器减少量",
        "大招增强 / 提升特殊武器的性能",
        "快速复活 / 缩短复活时间",
        "超级跳 / 缩短超级跳跃的时间",
        "副强 / 提升次要武器的性能",
        "安全鞋 / 减轻对手墨汁影响",
        "防爆 / 减轻次要武器影响",
        "行动强化"
        ];
        var BrandTend = [11, 0, 9, 8, 4, 12, 3, 4, 6, 5, 7, 1, 1, 2, 8, 6, 0, 3, 12, 13, 
        2, 9, 5, 7, 1, 6, 10, 11, 0, 10, 13, 10, 13, 5, -1, -1, -1, -1, -1, -1];

        class GearAbility{
            constructor(Ability, Seed, Brand){
                this.Ability = Ability;
                this.Brand = Brand;
                this.Seed = Seed;
            }
            GetNextAbility(Drink){
                this.Seed = GetNextSeed(this.Seed);
                if(Drink < 0 || Drink > 13){
                    this.Ability = GetSeedAbility(this.Seed, this.Brand, -1);
                    return this;
                }
                if(this.Seed % 100 < 30){
                    this.Ability = Drink;
                    return this;
                }
                this.Seed = GetNextSeed(this.Seed);
                this.Ability = GetSeedAbility(this.Seed, this.Brand, Drink);
                return this;
            }
        }
        class PlanResult{
            constructor(StepNum, StepSeed, DrinkNum){
                this.StepNum = StepNum;
                this.StepSeed = StepSeed;
                this.DrinkNum = DrinkNum;
            }
        }
        function GetSeedAbility(Seed, Brand, Drink){
            let AllWeight;
            let Stend = BrandTend[Brand * 2];
            let Wtend = BrandTend[Brand * 2 + 1];

            if(Stend == -1){
                if(Drink < 0 || Drink > 13) AllWeight = 28;
                else    AllWeight = 26;
            }else{
                if(Drink == Stend)  AllWeight = 25;
                else if(Drink == Wtend)  AllWeight = 34;
                else if(Drink < 0 || Drink > 13)    AllWeight = 35;
                else AllWeight = 33;
            }
            let Weight = Seed % AllWeight;

            // IDtable0  = document.getElementById('IDtable1');
            // var tab='<table border=1 width=1000"><tr>' + AllWeight + '   ' + Weight + '</tr> </table>';
            // IDtable0.innerHTML = tab;

            for(var temp = 0; temp < 14 ; temp++){
                if(temp == Drink)   continue;
                else if(temp == Wtend)    Weight = Weight - 1;
                else if(temp == Stend)    Weight = Weight - 10;
                else    Weight = Weight - 2;
                if(Weight < 0)  return temp;
            }
            
        }

        function GetNextSeed(Seed){
            Seed ^= (Seed << 13);
            Seed ^= (Seed >>> 17);
            Seed ^= (Seed << 5);
            Seed = Seed >>> 0;
            return Seed;
        }

        function SeedFindAll(Seed){
            
        }
        function SeedFindN(Seed, drink, Target){
            let drinktmp = drink;
            if(drinktmp < 0)  drinktmp = 14;
            for(let temp = 0; temp < AbilityName.length + 1; temp++){
                let SeedNTemp = copyobj(Seed);
                SeedNTemp.GetNextAbility((temp + drink) % 15);
                if(SeedNTemp.Ability == Target){
                    return (temp + drink) % 15;
                }
            }
            return -2;
        }
        function SeedFindNN(Seed, drink, TargetCode){
            let cost1 = -2;
            let cost2 = -2;
            if(drink < 0)   drink = 14;
            for(let temp = 0; temp < AbilityName.length + 1; temp++){
                let SeedT = copyobj(Seed);
                if((SeedT.GetNextAbility((temp + drink) % 15)).Ability == TargetCode[1]){
                    cost1 = (temp + drink) % 15;
                    if(TargetCode[2] != -1){
                        cost2 = SeedFindN(SeedT, temp, TargetCode[2]);
                        if(cost2 == -2) return [-2,-2];
                    }
                    return [cost1, cost2];
                }
            }
            return [-2,-2];
        }

        function CostNumCalcu(drink, cost, OStep, BStep){
            var res = new Array(4);
            let resnum = 0;
            if(drink > -1 && drink < 14){
                resnum ++;
            }    
            if(cost[0] != drink && cost[0] > -1 && cost[0] < 14){
                resnum++;
            }
            if(cost[0] != cost[1] && cost[1] > -1 && cost[1] < 14){
                resnum ++;
            }
            res[0] = resnum;
            res[1] = drink;
            res[2] = cost[0];
            res[3] = cost[1];
            return res;
        }

        function cleartable(){
            for(let temp = 0; temp < 9; temp++){
                IDtable0  =document.getElementById('IDtable' + temp);
                tab = '';
                IDtable0.innerHTML = tab;
            }
        }

        function SeedFind(Seed, TargetCode, IsFindAll){
            var SeedOri = copyobj(Seed);
            var CostNum = new Array();
            var CostNumP = 4;
            var PlanNum = 0;
            var ResStep = new Array(MAX_STEP);
            var isfirst = 1;
            var tablenum = 0;
            for(var OriginStep = 0; OriginStep < MAX_STEP ; OriginStep ++){

                for(var BranceStep = 0; BranceStep < 3; BranceStep ++){

                    for(var drink = -1; drink < AbilityName.length; drink++){
                        SeedBrance = copyobj(SeedOri);
                        for(var temp = 0; temp < BranceStep + 1; temp++){
                            SeedBrance.GetNextAbility(drink);
                            ResStep[OriginStep + temp] = copyobj(SeedBrance);
                        }
                        
                        if(SeedBrance.Ability == TargetCode[0]){
                            var Cost = SeedFindNN(SeedBrance, drink, TargetCode);
                            if (Cost[0] == -2)  continue;
                            CostNum = CostNumCalcu(drink, Cost, OriginStep, BranceStep);
                            if(CostNum[0] >= CostNumP) continue;
                            CostNumP = CostNum[0];
                            ResStep[OriginStep + BranceStep + 1] = copyobj(SeedBrance.GetNextAbility(CostNum[2]));
                            ResStep[OriginStep + BranceStep + 2] = copyobj(SeedBrance.GetNextAbility(CostNum[3]));
                            //out
                            if(IsFindAll == 1){
                                var newtr = document.createElement("tr");
                                if(TargetCode[2] == -1)
                                    var tbd = document.getElementById('table1');
                                else
                                    var tbd = document.getElementById('table0');
                                tbd.appendChild(newtr);

                                var newtd = document.createElement("td");
                                newtd.innerHTML = AbilityName[TargetCode[0]];
                                newtr.appendChild(newtd);
                                
                                var newtd = document.createElement("td");
                                if(TargetCode[2] == -1)
                                    newtd.innerHTML = (OriginStep + BranceStep + 2);
                                else
                                newtd.innerHTML = (OriginStep + BranceStep + 3);
                                newtr.appendChild(newtd);

                                var newtd = document.createElement("td");
                                newtd.innerHTML = CostNum[0];
                                newtr.appendChild(newtd);

                                if(CostNum[1] > -1 && CostNum[1] < 14){
                                    var newtd = document.createElement("td");
                                    newtd.innerHTML = AbilityName[CostNum[1]] + ' 饮料';
                                    newtr.appendChild(newtd);
                                }
                                if(CostNum[2] > -1 && CostNum[2] < 14 && CostNum[2] != CostNum[1]){
                                    var newtd = document.createElement("td");
                                    newtd.innerHTML = AbilityName[CostNum[2]] + ' 饮料';
                                    newtr.appendChild(newtd);
                                }
                                if(CostNum[3] > -1 && CostNum[3] < 14 && CostNum[2] != CostNum[3]){
                                    var newtd = document.createElement("td");
                                    newtd.innerHTML = AbilityName[CostNum[3]] + ' 饮料';
                                    newtr.appendChild(newtd);
                                }

                                return;
                            }
                            else{
                                IDtable0  = document.getElementById('IDtable' + tablenum);
                                tablenum ++;
                                var tab='<table border=1 width=1000">'
                                tab = tab + "<thead><tr> <td style='background:white'>编号</td><td style='background:white'>技能</td><td style='background:white'>种子</td></tr></thead><tbody>"
                                
                                for(let temp = 0; temp < OriginStep; temp++){
                                    tab += '<tr>';
                                    tab += "<td style='background:white'>" + (temp + 1) + "</td>";
                                    tab += "<td style='background:white'>" + AbilityName[ResStep[temp].Ability]  + "</td>";
                                    tab += "<td style='background:white'>0x" + ResStep[temp].Seed.toString(16) + "</td>";
                                    tab += '</tr>';
                                }

                                if(CostNum[1] >-1 && CostNum[1] < 14){
                                        tab += '<tr><td>' + '喝 ' + AbilityName[CostNum[1]]  + ' 饮料' + '</td> </tr>';
                                }

                                for(let temp = OriginStep; temp < OriginStep + BranceStep; temp++){
                                    tab += '<tr>';
                                    tab += "<td style='background:white'>" + (temp + 1) + "</td>";
                                    tab += "<td style='background:white'>" + AbilityName[ResStep[temp].Ability]  + "</td>";
                                    tab += "<td style='background:white'>0x" + ResStep[temp].Seed.toString(16) + "</td>";
                                    tab += '</tr>';
                                }
                                tab += '<tr><td>' + "接下来就是目标序列" + '</td> </tr>'

                                tab += '<tr>';
                                tab += "<td style='background:white'>" + (OriginStep + BranceStep + 1) + "</td>";
                                tab += "<td style='background:white'>" + AbilityName[ResStep[OriginStep + BranceStep].Ability]  + "</td>";
                                tab += "<td style='background:white'>0x" + ResStep[OriginStep + BranceStep].Seed.toString(16) + "</td>";
                                tab += '</tr>';

                                if(CostNum[2] != CostNum[1]){
                                    if(CostNum[2] < 0 || CostNum[2] > 13)
                                        tab += '<tr><td>' + "取消饮料效果" + '</td> </tr>';
                                    else
                                        tab += '<tr><td>' + '喝 ' + AbilityName[CostNum[2]] + ' 饮料' + '</td> </tr>';
                                }
                                tab += '<tr>';
                                tab += "<td style='background:white'>" + (OriginStep + BranceStep + 2) + "</td>";
                                tab += "<td style='background:white'>" + AbilityName[ResStep[OriginStep + BranceStep + 1].Ability]  + "</td>";
                                tab += "<td style='background:white'>0x" + ResStep[OriginStep + BranceStep + 1].Seed.toString(16) + "</td>";
                                tab += '</tr>';
                                if(TargetCode[2] != -1){
                                    if(CostNum[3] != CostNum[2]){
                                        if(CostNum[3] < 0 || CostNum[3] > 13)
                                            tab += '<tr><td>' + "取消饮料效果" + '</td> </tr>';
                                        else
                                            tab += '<tr><td>' + '喝 ' + AbilityName[CostNum[3]] + ' 饮料' + '</td> </tr>';
                                    }
                                    tab += '<tr>';
                                    tab += "<td style='background:white'>" + (OriginStep + BranceStep + 3) + "</td>";
                                    tab += "<td style='background:white'>" + AbilityName[ResStep[OriginStep + BranceStep + 2].Ability]  + "</td>";
                                    tab += "<td style='background:white'>0x" + ResStep[OriginStep + BranceStep + 2].Seed.toString(16) + "</td>";
                                    tab += '</tr>';
                                }

                                tab += '</tbody></table>';
                                IDtable0.innerHTML = tab;
                            }
                        }
                    }
                }
                SeedOri.GetNextAbility(-1);
                ResStep[OriginStep] = copyobj(SeedOri);
            }
        }

        function copyobj(Seed){
            var Seedres = new GearAbility(Seed.Ability, Seed.Seed, Seed.Brand);
            return Seedres;
        }


        function MainFunction(){
            cleartable();


            var SeedMain = new GearAbility;
            SeedMain.Seed = parseInt(document.getElementById('IDSeed').value);
            SeedMain.Seed = SeedMain.Seed >>> 0;
            SeedMain.Brand = parseInt(document.getElementById('IDClothes').value);

            var TargetCode = new Array(3);
            var Result = new Array();
            TargetCode[0] = parseInt(document.getElementById('IDTarget1').value);
            TargetCode[1] = parseInt(document.getElementById('IDTarget2').value);
            TargetCode[2] = parseInt(document.getElementById('IDTarget3').value);

            if(TargetCode[0] == -1){
                IDtable0  =document.getElementById('IDtable0');
                var tab='<table border=1 width=1000 id = "table0">';
                tab += "<thead> <tr> <td style='background:white'>技能</td><td style='background:white'>所需步骤</td><td style='background:white'>所需饮料数量</td><td style='background:white'>饮料1</td><td style='background:white'>饮料2</td><td style='background:white'>饮料3</td></tr></thead><tbody></tbody>";
                tab += '</table>';
                IDtable0.innerHTML = tab;
                for(let temp = 0; temp < 14; temp++){
                    TargetCode[0] = temp;
                    TargetCode[1] = temp;
                    TargetCode[2] = temp;
                    tab = SeedFind(SeedMain, TargetCode, 1);
                }
                
                IDtable0  =document.getElementById('IDtable1');
                var tab='<table border=1 width=1000 id = "table1">';
                tab += "<thead> <tr> <td style='background:white'>技能</td><td style='background:white'>所需步骤</td><td style='background:white'>所需饮料数量</td><td style='background:white'>饮料1</td><td style='background:white'>饮料2</td>/tr></thead><tbody></tbody>";
                tab += '</table>';
                IDtable0.innerHTML = tab;
                for(let temp = 0; temp < 14; temp++){
                    TargetCode[0] = temp;
                    TargetCode[1] = temp;
                    TargetCode[2] = -1;
                    tab = SeedFind(SeedMain, TargetCode, 1);
                }

            }else{
                SeedFind(SeedMain, TargetCode, 0);
            }
        }
    </script>
    <style>
        table {
            border-collapse: collapse;
            margin-top: 200px;
            margin-left: 500px;
        }
        table th{
            border: 1px solid black;
            width: 80px;
            height: 40px;
            text-align: center;
            background-color: cornsilk;
        }
        table td{
           
            border: 1px solid black;
            width: 80px;
            height: 40px;
            text-align: center;
        }
        body {
            background-color: #e9ecef;
            width: 90%;
            padding: 4rem 2rem;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;
        }
        .wrapper {
            background-color: #fff;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 1rem;
            margin-top: 10px;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: .5rem;
            font-weight: 500;
            line-height: 1.2;
            margin-top: 0;
        }
        </style>
    <body>
        <div class = "content">
            <div class="wrapper">
            <h1>喷喷喷技能序列搜索器</h1>
                <p>欢迎使用本网站</p>
				<p>此网站是用来辅助寻找自己想要的技能的</p>
                <p>此网站由我一人完成，并且我之前并没有学过JS，如有bug实属正常</p>
                <p>如果有bug请反馈给我qq:1464243589</p>
                <p>在使用我的方案之前请去lean大佬的网站复查一下</p>
		    </div>

            <div class = "wrapper">
            <h2>请输入衣服种子</h2>
                <p>求种子的网站在<a href="https://leanny.github.io/splat3seedchecker/#/seedrecover">这里</a></p>
                <input type = "text" id = "IDSeed" value = "0x915cfc31"/>
            </div>

            <form method="post" action=" ">
                <div class = "wrapper">
                <h2>请选择衣服品牌</h2>
                <p>
                  <select id="IDClothes">
                      <option value= '0' selected label="战斗鱿鱼 / SquidForce">战斗鱿鱼 / SquidForce</option>
                      <option value= '1' label="钢铁先锋 / Zink">钢铁先锋 / Zink</option>
                      <option value= '2' label="海月 / Krak-On">海月 / Krak-On</option>
                      <option value= '3' label="罗肯贝格 / Rockenberg">罗肯贝格 / Rockenberg</option>
                      <option value= '4' label="泽酷 / Zekko">泽酷 / Zekko</option>
                      <option value= '5' label="锻品 / Forge">锻品 / Forge</option>
                      <option value= '6' label="暖流 / Firefin">暖流 / Firefin</option>
                      <option value= '7' label="帆立 / Skalop">帆立 / Skalop</option>
                      <option value= '8' label="寺门 / Splash Mob">寺门 / Splash Mob</option>
                      <option value= '9' label="时雨 / Barazushi">时雨 / Barazushi</option>
                      <option value= '10' label="艾洛眼 / Tentatek">艾洛眼 / Tentatek</option>
                      <option value= '11' label="暇古 / Takoroka">暇古 / Takoroka</option>
                      <option value= '12' label="无法无天 / Annaki">无法无天 / Annaki</option>
                      <option value= '13' label="鱿皇 / Enperry">鱿皇 / Enperry</option>
                      <option value= '14' label="剑尖鱿 / Toni Kensa">剑尖鱿 / Toni Kensa</option>
                      <option value= '15' label="散寿司 / Barazushi">散寿司 / Barazushi</option>
                      <option value= '16' label="七轮 / Emberz">七轮 / Emberz</option>
                      <option value= '17' label="熊先生商会 / Grizzco">熊先生商会 / Grizzco</option>
                      <option value= '18' label="鱼干制造 / Cuttlegear">鱼干制造 / Cuttlegear</option>
                      <option value= '19' label="amiibo">amiibo</option>
                  </select>
                </p>
                </div>
            </form>
            <div class = "wrapper">
                <h3>请输入目标序列</h3>
                <p>可以只输入两个目标序列，需要将最后一个位置选位置</p>
                <p>三个序列位置都为未知时将输出所有节能的0.3和0.2消耗</p>
                    <select id="IDTarget1">
                        <option value= '-1' >未知</option>
                        <option value= '0' >主省 / 提升墨汁效率(主要武器)</option>
                        <option value= '1' >副省 / 提升墨汁效率(次要武器)</option>
                        <option value= '2' >墨回 / 提升墨汁槽的回复速度</option>
                        <option value= '3' >走速 / 提升人类状态移动速度</option>
                        <option value= '4' >游速 / 提升鱿鱼游动速度</option>
                        <option value= '5' >大招减量 / 提升特殊武器增加量</option>
                        <option value= '6' >sp死亡减轻 / 降低特殊武器减少量</option>
                        <option value= '7' >大招增强 / 提升特殊武器的性能</option>
                        <option value= '8' >快速复活 / 缩短复活时间</option>
                        <option value= '9' >超级跳 / 缩短超级跳跃的时间</option>
                        <option value= '10' >副强 / 提升次要武器的性能</option>
                        <option value= '11' >安全鞋 / 减轻对手墨汁影响</option>
                        <option value= '12' >防爆 / 减轻次要武器影响</option>
                        <option value= '13' >行动强化</option>
                    </select>
                    <select id="IDTarget2">
                        <option value= '-1' >未知</option>
                        <option value= '0' >主省 / 提升墨汁效率(主要武器)</option>
                        <option value= '1' >副省 / 提升墨汁效率(次要武器)</option>
                        <option value= '2' >墨回 / 提升墨汁槽的回复速度</option>
                        <option value= '3' >走速 / 提升人类状态移动速度</option>
                        <option value= '4' >游速 / 提升鱿鱼游动速度</option>
                        <option value= '5' >大招减量 / 提升特殊武器增加量</option>
                        <option value= '6' >sp死亡减轻 / 降低特殊武器减少量</option>
                        <option value= '7' >大招增强 / 提升特殊武器的性能</option>
                        <option value= '8' >快速复活 / 缩短复活时间</option>
                        <option value= '9' >超级跳 / 缩短超级跳跃的时间</option>
                        <option value= '10' >副强 / 提升次要武器的性能</option>
                        <option value= '11' >安全鞋 / 减轻对手墨汁影响</option>
                        <option value= '12' >防爆 / 减轻次要武器影响</option>
                        <option value= '13' >行动强化</option>
                    </select>
                    <select id="IDTarget3">
                        <option value= '-1' >未知</option>
                        <option value= '0' >主省 / 提升墨汁效率(主要武器)</option>
                        <option value= '1' >副省 / 提升墨汁效率(次要武器)</option>
                        <option value= '2' >墨回 / 提升墨汁槽的回复速度</option>
                        <option value= '3' >走速 / 提升人类状态移动速度</option>
                        <option value= '4' >游速 / 提升鱿鱼游动速度</option>
                        <option value= '5' >大招减量 / 提升特殊武器增加量</option>
                        <option value= '6' >sp死亡减轻 / 降低特殊武器减少量</option>
                        <option value= '7' >大招增强 / 提升特殊武器的性能</option>
                        <option value= '8' >快速复活 / 缩短复活时间</option>
                        <option value= '9' >超级跳 / 缩短超级跳跃的时间</option>
                        <option value= '10' >副强 / 提升次要武器的性能</option>
                        <option value= '11' >安全鞋 / 减轻对手墨汁影响</option>
                        <option value= '12' >防爆 / 减轻次要武器影响</option>
                        <option value= '13' >行动强化</option>
                    </select>
            </div>
            <div class = "wrapper">
                <input  id="button" type="button" value="生成方案" onclick="MainFunction();">
            
            <div id = "IDtable0"></div>
            <div id = "IDtable1"></div>
            <div id = "IDtable2"></div>
            <div id = "IDtable3"></div>
            <div id = "IDtable4"></div>
            <div id = "IDtable5"></div>
            <div id = "IDtable6"></div>
            <div id = "IDtable7"></div>
            <div id = "IDtable8"></div>
            </div>
        </div>
    </body>
</html>